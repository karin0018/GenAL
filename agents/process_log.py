import re
import numpy as np


def get_res(filename, threhold=0):
    print(filename)
    # 初始化存储列表
    goal_ids = []
    stus = []
    E_ps = []

    # 读取文件
    with open(filename, 'r') as file:
        lines = file.readlines()

    # 提取符合条件的记录并保存到相应列表
    pattern = r'goal_id = (\d+), stu = (\d+), E_p = (\d+\..*)'
    for line in lines:
        match = re.search(pattern, line)
        if match and float(match.group(3)) > threhold:
            goal_ids.append(int(match.group(1)))
            stus.append(int(match.group(2)))
            E_ps.append(float(match.group(3)))

    # 打印结果
    print("goal_id:", goal_ids)
    print("stu:", stus)
    print("E_p:", E_ps)
    print("mean:", len(E_ps),np.mean(E_ps),"std = ",  np.std(E_ps))

dataname = "junyi"
step = 20
threhod = 0.08
get_res(f'../pretrained_models/KES_{dataname}/{dataname}_llama2_{step}_reflectionTrue_qtextTrue_wo.txt',threhod)
get_res(f'../pretrained_models/KES_{dataname}/{dataname}_llama3_{step}_reflectionTrue_qtextTrue_wo.txt',threhod)
get_res(f"../pretrained_models/KES_{dataname}/{dataname}_gpt-3.5-turbo-1106_{step}_reflectionTrue_qtextTrue_wo.txt",threhod)
# get_res(f"../pretrained_models/KES_{dataname}/{dataname}_gpt-3.5-turbo-1106_{step}_reflectionFalse_qtextTrue_wo.txt",threhod)
# get_res(f"../pretrained_models/KES_{dataname}/{dataname}_gpt-3.5-turbo-1106_{step}_reflectionTrue_qtextFalse_wo.txt",threhod)

"""
junyi-gpt-3.5
goal_id: [38, 38, 12, 22, 22, 22, 22]
stu: [0, 0, 1, 1, 1, 2, 2]
E_p: [0.2793417517279074, 0.2793417517279074, 0.22861931158273424, 0.34359541351780565, 0.34359541351780565, 0.2928426598780324, 0.2928426598780324]
mean: 7 0.29431128026146075

junyi-llama3
goal_id: [38, 12, 22, 22, 38, 12, 22, 22, 22, 22, 1, 22, 22, 22, 22]
stu: [0, 1, 1, 2, 3, 6, 6, 8, 10, 12, 15, 17, 19, 21, 23]
E_p: [0.3097288178704033, 0.26616549941272655, 0.34359541351780565, 0.2928426598780324, 0.26033360003130646, 0.27008353194565105, 0.4030545986488674, 0.3696947317708976, 0.28533679905237286, 0.2204062959930448, 0.243682457343042, 0.27874216732710344, 0.26823159025813986, 0.2857354911916549, 0.23782635462693033]
mean: 0.28903066725786525

junyi-llama2
goal_id: [38, 22, 12, 22, 22, 38, 12, 22, 38, 22, 22, 22, 22, 22]
stu: [0, 1, 1, 1, 6, 6, 6, 6, 8, 8, 8, 10, 10, 12]
E_p: [0.28894441243093794, 0.34359541351780565, 0.20640566195735502, 0.3384918885347135, 0.27252496571721124, 0.2402581787257418, 0.21565381172218703, 0.36105636063766067, 0.20374332581522697, 0.2771217252718596, 0.2771217252718596, 0.28533679905237286, 0.2310036617097927, 0.2204062959930448] 
mean: 0.2686903018826978

./junyi_llama2_s10.log
goal_id: [38, 38, 22, 38, 22, 38, 22, 1, 12, 22, 38, 38, 22, 38, 38, 22, 38, 22, 22, 22]
stu: [0, 0, 1, 2, 2, 3, 3, 3, 6, 6, 6, 8, 8, 10, 10, 12, 15, 15, 17, 19]
E_p: [0.2874229480196444, 0.2600899250652596, 0.34359541351780565, 0.28818046911326045, 0.2270745616717124, 0.37623544534839237, 0.273279377450564, 0.2937146599892529, 0.2968751180117352, 0.46268157217943046, 0.3960306531900523, 0.24843999808643388, 0.2771217252718596, 0.5274387118394354, 0.2475653410626241, 0.22170744304525075, 0.29855656480867, 0.3943437589043938, 0.2673425744686831, 0.26823159025813986]
mean: 20 0.31279639256513003

./junyi_llama3_s10.log
goal_id: [26, 26, 29, 26, 15]
stu: [0, 1, 1, 2, 6]
E_p: [0.42178742675032777, 0.4545455040646629, 0.2140684456837452, 0.36646058999571995, 0.29158397994224355]
mean: 5 0.3496891892873399

./logs/assist_wd_l2_s5.log
goal_id: [68, 36, 37, 54, 39, 14, 37, 71, 41, 29, 37, 29, 54, 37, 71]
stu: [10, 10, 59, 59, 61, 61, 34, 34, 34, 34, 6, 6, 6, 65, 65]
E_p: [0.022578667713902493, 0.013749901772285406, 0.020597080963305568, 0.020093277247810876, 0.014205200791245884, 0.012880642692514106, 0.019147560170596177, 0.019195473376989087, 0.023993870167550387, 0.02180359107056888, 0.020939591613012627, 0.0213316545881323, 0.019361497068608544, 0.019147277924078134, 0.019195164980211638]
mean: 15 0.019214696809387474

./logs/assist_wd_l3_s5.log
goal_id: [32, 11, 70, 37, 54, 9, 7]
stu: [31, 31, 99, 59, 59, 47, 47]
E_p: [0.03135224056414248, 0.01490676654021332, 0.03961435903655768, 0.020597204705901664, 0.02009364278772863, 0.010081198203429542, 0.020326754988830565]
mean: 7 0.022424595260971986

./assist_llama3_s5.log
goal_id: [20, 21, 110, 78, 10]
stu: [27, 27, 27, 27, 27]
E_p: [0.08219434725344511, 0.3952542121761131, 0.046865388401144036, 0.04096887918200423, 0.22425248341070897]
mean: 5 0.1579070620846831
"""